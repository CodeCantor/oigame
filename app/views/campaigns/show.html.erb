<% @page_title = @campaign.name %>

<div id="campaigns-wrapper">
  <div id="show-campaign">
    <div id="show-campaign-detail">
      <div id="show-campaign-detail-main">
      <h2><%= @campaign.name %></h2>
      <div class="grid_8">
        <% unless @campaign.status == 'archived' %>
          <p><strong><%= I18n.t(:created_at) %> <%= time_ago_in_words(@campaign.created_at) %> |
            <%= I18n.t(:time_left) %> <%= (@campaign.duedate_at - Time.now).round / 60 / 60 / 24 %> <%= I18n.t(:days) %></strong></p>
        <% else %>
          <p><strong><%= I18n.t(:created_at) %> <%= time_ago_in_words(@campaign.created_at) %> |
            <%= I18n.t(:archived_campaign) %></strong></p>
        <% end %>
      </div>
      <div class="clear"></div>
      <div class="grid_12">
        <div id="campaign-information">
          <div class="thermometer">
            <div class="thermocontainer">
              <div class="signatures-needed">
                <% if @campaign.ttype == 'mailing' %>
                  <span id="participants" class="big strong"><%= @campaign.messages.validated.count %></span>
                <% elsif @campaign.ttype == 'petition' %>
                  <span id="participants" class="big strong"><%= @campaign.petitions.validated.count %></span>
                <% end %>
                <span class="small weak"><%= I18n.t(:of) %></span>
                <span id="participants-target" class="big strong weak"><%= @campaign.target %></span> <%= I18n.t(:participants) %>
            </div>
            <div style="width: 0%" class="mercury"></div>
          </div>
        </div><!-- campaing-information -->
      </div>
      <div id="action-buttons">
        <p>
          <% if can?(:moderated, @campaign) %>
            <span class="label warning">
              <a href="mailto:<%= @campaign.user.email %>"><%= I18n.t(:contact) %></a>
            </span>
          <% end %>
          <% if @campaign.status == 'archived' %>
          <% elsif @campaign.status == 'active' %>
            <% if can?(:archive, @campaign) %>
              &nbsp;&nbsp;
              <span class="label">
                <%= link_to t(:archive), @sub_oigame ? archive_sub_oigame_campaign_path(@sub_oigame) : archive_campaign_path, :confirm => t(:are_you_sure), :method => :post %>
              </span>
            <% end %>
            <% if can?(:moderated, @campaign) && @campaign.moderated? %>
              &nbsp;&nbsp;
              <span class="label success">
                <%= link_to t(:activate), @sub_oigame ? activate_sub_oigame_campaign_path(@sub_oigame) : activate_campaign_path, :confirm => t(:are_you_sure), :method => :post %>
              </span>
            <% end %>
            <% if can?(:deactivate, @campaign) && @campaign.published? %>
              &nbsp;&nbsp;
              <span class="label success">
                <%= link_to t(:deactivate), @sub_oigame ? deactivate_sub_oigame_campaign_path(@sub_oigame) : deactivate_campaign_path, :confirm => t(:are_you_sure), :method => :post %>
              </span>
            <% end %>
            <% if can? :update, @campaign %>
              &nbsp;&nbsp;
              <span class="label notice">
                <%= link_to t(:edit), @sub_oigame ? edit_sub_oigame_campaign_path(@sub_oigame) : edit_campaign_path(@campaign) %>
              </span>
            <% end %>
            <% if can? :priority, @campaign %>
              &nbsp;&nbsp;
              <% unless @campaign.priority == true %>
                <span class="label" style="background-color:#088A85;">
                  <%= link_to t(:prioritize), @sub_oigame ? prioritize_sub_oigame_campaign_path(@sub_oigame) : prioritize_campaign_path, :confirm => t(:are_you_sure), :method => :post %>
                </span>
              <% else %>
                <span class="label" style="background-color:#088A85;">
                  <%= link_to t(:deprioritize), @sub_oigame ? deprioritize_sub_oigame_campaign_path(@sub_oigame) : deprioritize_campaign_path, :confirm => t(:are_you_sure), :method => :post %>
                </span>
              <% end %> 
            <% end %>
            <% if can? :destroy, @campaign %>
              &nbsp;&nbsp;
              <span class="label important">
                <%= link_to t(:delete), @sub_oigame ? sub_oigame_campaign_path(@sub_oigame) : @campaign, :confirm => t(:are_you_sure), :method => :delete %>
              </span>
            <% end %>
          <% end %>
        </p>
      </div>
    </div>

          <% if @campaign.image.to_s %>
            <%= image_tag(@campaign.image_url.to_s) %>
          <% end %>

    <ul class="tabs" data-tabs="tabs" >
      <li class="active"><a href="#description"><%= I18n.t(:description) %></a></li>
      <li><a href="#message"><%= I18n.t(:message) %></a></li>
      <% unless @campaign.status == 'archived' %>
        <li data-tab-type="stats"><a href="#stats"><%= I18n.t(:stats) %></a></li>
      <% end %>
    </ul><!-- tabs -->
    <div class="tab-content" id="my-tab-content">
      <div id="description" class="active">
        <div id="campaign-info">
          <h2>Descripci√≥n</h2>
          <%= @campaign.to_html(@campaign.intro).html_safe %> 
          <%= @campaign.to_html(@campaign.body).html_safe %> 
        </div>
      </div><!-- description -->
      <div id="message">
        <div id="campaign-info">
          <h2><%= I18n.t(:recipients) %></h2>
          <p><%= I18n.t(:recipients_show) %></p>
            <ul>
              <% @campaign.recipients.gsub('@', '[arroba]').split(' ').each do |dest| %> 
                <li><%= dest %></li>
              <% end %>
            </ul>
            <h2><%= I18n.t(:message) %></h2>
            <b><%= I18n.t(:subject) %></b>: <%= @campaign.default_message_subject %> 
          <p>
            <pre>
              <%= @campaign.default_message_body %>
            </pre>
          </p>
        </div>
      </div><!-- message -->
      <% unless @campaign.status == 'archived' %>
        <div id="stats">
          <%= render :partial => "stats_chart" %>
        </div><!-- message -->
      <% end %>

    </div><!-- tab-content -->

    </div><!-- show-campaign-detail-main -->
        

    </div><!-- show-campaign-detail -->
    <div id="show-campaign-sidebar" class="grid_8">
      
      <% unless @campaign.status == 'archived' %>

        <% if @campaign.ttype == 'petition' %>
          <div id="show-campaign-petition">
            <%= render :partial => 'petition_form' %>
          </div>
        <% end %>

        <% if @campaign.ttype == 'mailing' %>
          <div id="show-campaign-mailing">
            <%= render :partial => 'mailing_form' %>
          </div>
        <% end %>
        
        <h2 class="jtc"><%= I18n.t(:spread) %></h2>
        <%= render :partial => 'modal_widget_form' %>
        <div id="diffusion">
          <%= I18n.t(:spread_info) %>
          <a id="show-modal-widget" href="#" class="btn btn-large btn-primary center"><%= I18n.t(:spread_form) %></a>
        </div>

        <%= render :partial => "communication", :locals => { :share_url => CGI::escape(APP_CONFIG[:domain]+"/campaigns/"+@campaign.slug) } %>

      <% end %>

    </div><!-- show-campaign-sidebar -->
  </div><!-- show-campaign -->
</div><!-- campaigns-wrapper -->
